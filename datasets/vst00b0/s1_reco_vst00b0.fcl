# -*- mode:tcl -*-
#------------------------------------------------------------------------------
# - use DeltaFinder to flag compton electron hits
# - use TZClusterFinder for time clustering
# - use PhiClusterFinder to provide input to the patttern recognition
# - TRIGGER_PATHS: p33 : use KFF (BTrk), p34 : use KK (reconstruction_templates)
#------------------------------------------------------------------------------
BEGIN_PROLOG
  INPUT_MODULE  @protect_ignore: RootInput        # choices: EmptyEvent / RootInput
  TRIGGER_PATHS @protect_ignore: [ p34 ]          # KK (KinKal) fits
END_PROLOG

#include "Stntuple/fcl/stntuple.fcl"

process_name : S5Reco

services.GeometryService.inputFile    : "pipenu/datasets/rpc14b0/geom_pipenu_rpc14b0.txt"
services.GeometryService.bFieldFile   : "Offline/Mu2eG4/geom/bfgeom_v01.txt"
services.TFileService.fileName        : "/dev/null"

source.fileNames    : [ "to_be_defined.art" ]
source.inputCommands: ["keep *",
                       "drop mu2e::ComboHitCollection_*_*_*"
		       ]
physics : {
    producers : { 

        @table::Digitize.producers
        @table::Reconstruction.producers

        TZClusterFinder    : { @table::CalPatRec.producers.TZClusterFinder  } 

#	PhiClusterFinder   : { @table::CalPatRec.producers.PhiClusterFinder }
       
	KKDePar : { @table::Reconstruction.producers.KKDe }
    }
    
    filters   : { @table::Reconstruction.filters   }
#------------------------------------------------------------------------------
# muon reconstruction, both signs
#------------------------------------------------------------------------------
    @table::production.paths

    trigger_paths : [ @sequence::TRIGGER_PATHS ]
    
    e1            : [ defaultOutput ]
    end_paths     : [ e1            ]
}
#------------------------------------------------------------------------------
# start reconstruction as early as possible
#------------------------------------------------------------------------------
#include "pipenu/fcl/reco_start_time.fcl"

physics.producers.TZClusterFinder.clusterThresh           : 10     # min N straw hits
physics.producers.TZClusterFinder.runDisplay              : 0
physics.producers.TZClusterFinder.diagLevel               : 0      ## 1

physics.producers.HelixFinderDe.ComboHitCollection              : "flagPH"
physics.producers.HelixFinderDe.TimeClusterCollection           : "TZClusterFinder"
physics.producers.CalHelixFinderDe.TimeClusterCollectionLabel   : "TZClusterFinder"
# physics.producers.KKDePar.ModuleSettings.HelixSeedCollections   : [ "MHDe" ]
# physics.producers.KKDePar.UsePDGCharge                          : false
#------------------------------------------------------------------------------
# outputs.defaultOutput.outputCommands  : [ "keep *_*_*_*" ] ## @local::Reconstruction.Output.outputCommands 
outputs.defaultOutput.fileName        : "mcs.user.rpc14b0s51r0001.pipenu.001210_00000000.art"
#------------------------------------------------------------------------------
# Uncomment the below lines if one wants a truncated report i.e with the "Run,Event,SubRun" 
# numbers not mentioned for every event
#------------------------------------------------------------------------------
